---
- name: Install Docker and Nginx
  hosts: all
  become: true
  tasks:
     - name: Update apt cache
       apt:
          update_cache: yes
          cache_valid_time: 3600

     - name: Install Docker dependencies
       apt:
          name:
             [
                "apt-transport-https",
                "ca-certificates",
                "curl",
                "gnupg-agent",
                "software-properties-common",
             ]
          state: present

     - name: Add Docker GPG key
       apt_key:
          url: https://download.docker.com/linux/ubuntu/gpg
          state: present

     - name: Add Docker repository
       apt_repository:
          repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable
          state: present

     - name: Install Docker
       apt:
          name: docker-ce
          state: present

     - name: Install Docker Compose
       apt:
          name: docker-compose
          state: present

     - name: Start and enable Docker service
       service:
          name: docker
          state: started
          enabled: yes
